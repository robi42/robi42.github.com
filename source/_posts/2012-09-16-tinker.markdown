---
layout: post
title: "Tinker"
date: 2012-09-16 12:40
published: false
comments: true
categories:
---

{% codeblock Simple Tweet Model lang:csharp %}
public class Tweet
{
    public long     Id        { get; set; }
    public DateTime CreatedAt { get; set; }
    public string   Text      { get; set; }
}
{% endcodeblock %}

{% codeblock Simple Twitter API Client lang:csharp %}
public class TwitterApiClient
{
    const string BaseUrl = "https://api.twitter.com/1/statuses/";

    public void DoWithTweetsForUser(string username, Action<IList<Tweet>> callback)
    {
        var webClient = new WebClient();

        webClient.DownloadStringCompleted += (sender, e) => {
            var tweets = (from element in JsonValue.Parse(e.Result) as JsonArray
                let tweetData = element as JsonObject
                select new Tweet {
                    Id        = tweetData["id"],
                    CreatedAt = DateTime.ParseExact(tweetData["created_at"],
                                                    "ddd MMM dd HH:mm:ss zz00 yyyy", null),
                    Text      = tweetData["text"],
                })
                .ToList();

            callback(tweets);
        };

        var url = string.Format("{0}user_timeline.json?screen_name={1}",
                                BaseUrl, Uri.EscapeUriString(username));

        webClient.DownloadStringAsync(new Uri(url));
    }
}
{% endcodeblock %}

{% codeblock Exemplary User Code lang:csharp %}
var apiClient = new TwitterApiClient();

apiClient.DoWithTweetsForUser("robi42", tweets => {
    foreach (var tweet in tweets) // Just for demo purpose.
        Debug.WriteLine("Tweet from {0}: {1}", tweet.CreatedAt, tweet.Text);
});
{% endcodeblock %}
